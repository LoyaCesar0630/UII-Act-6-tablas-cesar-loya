{% extends 'base.html' %}

{% block content %}
<div class="card">
    <h2>Crear Pedido Múltiple</h2>
    
    {% if error %}
        <div class="alert" style="background: #ffeaa7; color: #2d3436; border: 1px solid #fdcb6e;">
            {{ error }}
        </div>
    {% endif %}
    
    <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label class="form-label">Seleccionar Cliente *</label>
            <select name="usuario_id" class="form-control" required>
                <option value="">Seleccione un cliente</option>
                {% for usuario in usuarios %}
                    <option value="{{ usuario.id }}">{{ usuario.nombre }} - {{ usuario.email }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">Dirección de Envío *</label>
            <textarea name="direccion" class="form-control" rows="3" placeholder="Ingrese la dirección completa de envío" required></textarea>
        </div>
        
        <h3>Seleccionar Productos</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            {% for producto in productos %}
            <div class="card" style="padding: 1rem;">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <input type="checkbox" name="productos" value="{{ producto.id }}" id="producto_{{ producto.id }}">
                    <label for="producto_{{ producto.id }}" style="font-weight: bold; cursor: pointer;">
                        {{ producto.nombre }}
                    </label>
                </div>
                
                {% if producto.imagen %}
                    <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 5px; margin-bottom: 0.5rem;">
                {% endif %}
                
                <p style="margin: 0.25rem 0;"><strong>Precio:</strong> ${{ producto.precio }}</p>
                <p style="margin: 0.25rem 0;"><strong>Stock:</strong> {{ producto.stock }}</p>
                
                <div class="form-group" style="margin-top: 0.5rem;">
                    <label class="form-label">Cantidad:</label>
                    <input type="number" name="cantidad_{{ producto.id }}" class="form-control" value="1" min="1" max="{{ producto.stock }}" disabled>
                </div>
            </div>
            {% empty %}
            <div class="card" style="text-align: center; padding: 2rem;">
                <p>No hay productos disponibles</p>
            </div>
            {% endfor %}
        </div>
        
        <div style="display: flex; gap: 1rem;">
            <button type="submit" class="btn btn-primary">Crear Pedido</button>
            <a href="{% url 'catalogo_productos' %}" class="btn" style="background: #6c757d; color: white;">Cancelar</a>
        </div>
    </form>
</div>

<script>
    // Habilitar campos de cantidad cuando se selecciona un producto
    document.addEventListener('DOMContentLoaded', function() {
        const checkboxes = document.querySelectorAll('input[name="productos"]');
        
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const productId = this.value;
                const quantityInput = document.querySelector(`input[name="cantidad_${productId}"]`);
                
                if (this.checked) {
                    quantityInput.disabled = false;
                } else {
                    quantityInput.disabled = true;
                    quantityInput.value = '1';
                }
            });
        });
    });
</script>
{% endblock %}